!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(function(){return function(){"use strict";var e={r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);function r(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Object.create;var i;Object.create;var o,a,s,c=((i={}).pageURL={handler:function(e){return""+e.location.hostname+e.location.pathname}},i.pagePathname={handler:function(e){return e.location.pathname}},i.nonce={handler:function(e){return e.state.browser.cspNonce}},i),u=function(){function e(e,t,r){this.pixels=e,this.context=t,this.variablesManager=r,this._loadedPixels=[]}return e.prototype.loadPixel=function(e,t){return r(this,void 0,void 0,(function(){var r,i,o,a,s;return n(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,6,,7]),void 0===(r=this._findPixel(e)))throw new Error("Can't find pixel with name "+e);if(this._pixelLoaded(r))return[2,!1];if(!this._isAllowedPixel(e))return[2,!1];if(this._loadedPixels.push(r.name),i=this._checkConditions(r.conditionsLoad),o=i.condBefore,a=i.condAfter,"function"==typeof r.beforeOnLoad&&o&&r.beforeOnLoad({context:this.context,variablesManager:this.variablesManager}),this._loadNoscriptPixel(r),!o||!a)return[3,5];switch(r.type){case"img":return[3,1]}return[3,3];case 1:return[4,this._loadImgPixel(r,t)];case 2:return n.sent(),[3,5];case 3:return[4,this._loadScriptPixel(r,t)];case 4:return n.sent(),[3,5];case 5:return"function"==typeof r.afterOnLoad&&a&&r.afterOnLoad(),[2,!0];case 6:return(s=n.sent()).message="PixelManager: "+e+" "+s.message,console.error(s),[2,!1];case 7:return[2]}}))}))},e.prototype._isAllowedPixel=function(e){for(var t,r,n,i,o=null!==(i=null===(n=null===(r=null===(t=this.context)||void 0===t?void 0:t.state)||void 0===r?void 0:r.resolveParams)||void 0===n?void 0:n["thirdparty.allowedSDKs"])&&void 0!==i?i:[],a=0;a<o.length;a++)if(e.startsWith(o[a]))return!0;return!1},e.prototype._checkConditions=function(e){var t=!0,r=!0;return e?("function"==typeof e.before&&(t=e.before(this.context)),"function"==typeof e.after&&(r=e.after(this.context)),{condBefore:t,condAfter:r}):{condBefore:t,condAfter:r}},e.prototype._findPixel=function(e){return(this.pixels||[]).find((function(t){return t.name===e}))},e.prototype._pixelLoaded=function(e){return void 0!==this._loadedPixels[e.name]},e.prototype._loadScriptPixel=function(e,t){var r=this;return new Promise((function(n){try{var i=document.createElement("script"),o=c.nonce.handler(r.context);i.setAttribute("nonce",o),i.setAttribute("src",e.src),i.setAttribute("id","pixel-script-"+e.name),i.setAttribute("class","pixel-script"),r.delegateOnLoad(i,e,t,n),document.body.appendChild(i)}catch(e){e.message="_loadScriptPixel "+e.message,console.error(e)}}))},e.prototype._loadNoscriptPixel=function(e){if(e.noscript){var t=document.createElement("noscript"),r=document.createElement("img");t.setAttribute("id","pixel-noscript-"+e.name),t.setAttribute("class","pixel-script"),r.setAttribute("display","none"),r.setAttribute("width","1"),r.setAttribute("height","1"),r.setAttribute("src",e.noscript),t.appendChild(r),document.body.appendChild(t)}},e.prototype._loadImgPixel=function(e,t){var r=this;return new Promise((function(n){var i=document.createElement("img");i.setAttribute("src",e.src),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("style","display: none;"),i.setAttribute("id","pixel-img-"+e.name),i.setAttribute("class","pixel-script"),document.body.appendChild(i),r._scriptListener(i,e,t,n)}))},e.prototype.delegateOnLoad=function(e,t,r,n){var i=this;e instanceof HTMLScriptElement&&e.addEventListener("load",(function(){i._scriptListener(e,t,r,n)}))},e.prototype._scriptListener=function(e,t,r,n){try{void 0!==t.onload&&t.onload(this.context),"function"==typeof r&&r(this.context),"function"==typeof n&&n()}catch(e){e.message="delegateOnLoad "+e.message,console.error(e)}},e}(),l=function(){function e(e,t){this.variables=e,this.context=t}return e.prototype.addVariable=function(e,t){if(this.variables[e])throw new Error("Variable "+e+" already exists");this.variables[e]=t},e.prototype.getVariable=function(e){var t=this.variables[e];if(!t)throw new Error("Variable "+e+" not found");return t.handler(this.context)},e}(),d=function(){function e(e,t,r,n){this.context=t,this.variablesManager=r,this.pixelsManager=n,this._tagsMap={};for(var i=0;i<e.length;i++)this._addTag(e[i]);this._tagsContext=Object.assign({},t,{variablesManager:r,pixelsManager:n})}return e.prototype._addTag=function(e){if(void 0!==this._tagsMap[e.name])throw new Error("Tag with name '"+e.name+"' already exists");this._tagsMap[e.name]=e},e.prototype.callTag=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:if(void 0===this._tagsMap[e])throw new Error("Tag with name '"+e+"' not found");return[4,this._tagsMap[e].handler.call(this,this._tagsContext,t)];case 1:return r.sent(),[2]}}))}))},e.prototype.executeByTrigger=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){var r,i,o,a,s;return n(this,(function(n){switch(n.label){case 0:for(a in n.trys.push([0,5,,6]),r=[],this._tagsMap)this._tagsMap[a].triggers.indexOf(e)>=0&&r.push(a);i=0,o=r,n.label=1;case 1:return i<o.length?(a=o[i],[4,this.callTag(a,t)]):[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return[2,!0];case 5:return(s=n.sent()).message="TagManager: error with "+e+" "+s.message,console.error(s),[2,!1];case 6:return[2]}}))}))},e}(),f=function(){function e(e,t,r){var n=this;this.triggers=e,this.variableManager=t,this.tagManager=r,this._triggersQueue={},this._queueHandling=!1,this.callTriggersByEvent("APP_LOADED"),document.addEventListener("click",(function(e){n.callTriggersByEvent("CLICK",{event:e})}))}return e.prototype.callTriggersByEvent=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){var r,i,o,a,s,c;return n(this,(function(n){try{for(r=Object.keys(this.triggers),i=0,o=r;i<o.length;i++)a=o[i],(s=this.triggers[a]).event===e&&this._checkConditions(s,t)&&(c=s.priority||0,this._triggersQueue[c]||(this._triggersQueue[c]=[]),this._triggersQueue[c].push(Object.assign({},s,{name:a,args:t})));this._queueHandling||(this._queueHandling=!0,this._handlerExecute())}catch(t){t.message="TriggerManager: error with event "+e+" "+t.message,console.error(t)}return[2]}))}))},e.prototype._checkConditions=function(e,t){var r=this._checkVariables(e),n=this._checkArgs(e,t);return r&&n},e.prototype._checkArgs=function(e,t){if(!e.mustedEventArgs)return!0;for(var r in e.mustedEventArgs)if(t[r]!==e.mustedEventArgs[r])return!1;return!0},e.prototype._checkVariables=function(e){if(!e.variables)return!0;for(var t=0,r=Object.keys(e.variables);t<r.length;t++){var n=r[t],i=e.variables[n];if("function"!=typeof i){if(i!==this.variableManager.getVariable(n))return!1}else if(!i(this.variableManager.getVariable(n)))return!1}return!0},e.prototype._handlerExecute=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,o,a;return n(this,(function(n){switch(n.label){case 0:if(!this._queueHandling)return[3,5];if(!(e=Object.keys(this._triggersQueue)).length)return this._queueHandling=!1,[3,5];t=e[e.length-1],r=this._triggersQueue[t],i=0,o=r,n.label=1;case 1:return i<o.length?(a=o[i],[4,this.tagManager.executeByTrigger(a.name,a.args)]):[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return delete this._triggersQueue[t],[3,0];case 5:return[2]}}))}))},e}(),h=[{name:"ga4",src:"//www.googletagmanager.com/gtag/js?id=G-JNVTMNXQ6F"}],g=[{name:"init GA4",triggers:["trigger for init ga4"],handler:function(e){e.pixelsManager.loadPixel("ga4")}},{name:"test alert",triggers:["qaAlert"],handler:function(){alert("This is test alert")}},{name:"Global Pixels - Source check",triggers:["globalPixels_sourceCheck"],handler:function(e){try{var t=document.referrer;e.location.href.split("&").forEach((function(e){-1!==e.indexOf("utm_source")&&window.localStorage.setItem("__utm_source",e.split("=")[1]),-1!==e.indexOf("utm_medium")&&window.localStorage.setItem("__utm_medium",e.split("=")[1]),-1!==e.indexOf("utm_content")&&window.localStorage.setItem("__utm_content",e.split("=")[1]),-1!==e.indexOf("utm_campaign")&&window.localStorage.setItem("__utm_campaign",e.split("=")[1]),-1!==e.indexOf("utm_term")&&window.localStorage.setItem("__utm_term",e.split("=")[1])})),window.sessionStorage.setItem("referrer",t)}catch(e){console.warn("GTM-TAG: Global Pixel - Source check "+e)}}}],p=((o={}).pageView={event:"APP_PAGE_CHANGED"},o.qaAlert={event:"APP_LOADED",variables:(a={},a.pagePathname="/bxfeqa/alertsPage",a)},o.globalPixels_sourceCheck={event:"APP_LOADED",priority:1,variables:(s={},s.pageURL=function(e){return e.indexOf("ozon.ru/ozoncardapp")<0},s)},o["trigger for init ga4"]={event:"APP_LOADED"},o);return window.otm={init:function(e){var t={get location(){return window.location},get router(){return window.$composerRouter},get state(){return e}},r=new l(c,t),n=new u(h,t,r),i=new d(g,t,r,n),o=new f(p,r,i);window.otm.setTrigger=o.callTriggersByEvent.bind(o),window.otm.otmVersion="1.1.33"}},"otmState"in window&&window.otm.init(window.otmState),t}()}));